jQuery(function(e){var a={init:function(){this.init_chosen(),this.handle_show_hide(),this.disable_default_currency(),this.toggle_update_custom_prices(),this.exchange_rate_table_tooltip(),this.toggle_exchange_rate_field(),e("tr.exchange-rate-row input.set_manually").on("change",this.toggle_exchange_rate_field),e("button#cs-update-exchange-rates").on("click",this.update_exchange_rate),e('input[name="_give_price_option"],input[name="_give_currency_price"]').on("change",this.toggle_custom_amount).change(),e("#_give_donation_levels_field").find(".give-add-repeater-field-section-row").on("click",this.toggle_update_custom_prices),e(".give-setting-tab-body .exchange-rate-row").on("click",".toggle-row",function(){e(this).closest("tr").toggleClass("is-expanded")}),e('input[name="cs_supported_currency[]"]').on("change",this.updateDefaultCurrencyList)},exchange_rate_table_tooltip:function(){e("div.currency-switcher-table").each(function(){var a=jQuery(this),t=a.find("th.column-number_decimal"),i=a.find("th.column-rate_markup"),n=t.html(),c=i.html();t.html(""),i.html(""),e("<span/>",{"class":"give-tooltip hint--top hint--medium hint--bounce give-cs-table-col","aria-label":cs_admin_vars.decimal_number_help,text:n}).appendTo(t),e("<span/>",{"class":"give-tooltip hint--top hint--medium hint--bounce give-cs-table-col","aria-label":cs_admin_vars.rate_markup_help,text:c}).appendTo(i)})},toggle_update_custom_prices:function(t){setTimeout(function(){var t="";t=e(this).hasClass("give-add-repeater-field-section-row")?e(this).closest(".give_options_panel").find("#_give_donation_levels_field"):e("#_give_donation_levels_field"),t.find("tr.give-row").not(".give-template").each(function(t,i){0===e(this).find(".cs_custom_price_option:checked").length&&e(this).find(".cs_custom_price_option").attr("checked","checked"),e(this).find(".cs_custom_price_option").on("change",a.toggle_handle_variable_prices).change()})},100)},toggle_exchange_rate_field:function(){e("div.cs_exchange_rates").find("tr.exchange-rate-row").each(function(a,t){$exchange_rate_field=e(this).find("input.exchange_rate"),!$exchange_rate_field.closest("tr").find("td.column-exchange_rates span.cs-exchange-rate-field-wrap").length>0&&$exchange_rate_field.wrap('<span class="cs-exchange-rate-field-wrap"></span>');var i=e(this).closest("tr").find("td.column-exchange_rates span.cs-exchange-rate-field-wrap");if(e(this).find("input.set_manually").is(":checked"))$exchange_rate_field.removeAttr("readonly"),i.find("a").remove();else{$exchange_rate_field.attr("readonly","readonly");var n=e("<a>",{"class":"give-icon-locked-anchor",html:e("<i>",{"class":"give-icon give-icon-locked"})});i.append(n)}})},disable_default_currency:function(){e('input[name="cs_supported_currency[]"][value="'+cs_admin_vars.default_currency+'"]').attr("checked","checked").addClass("disabled").on("click",function(e){return e.stopPropagation(),!1})},init_chosen:function(){e(".cs-chosen-field").chosen({width:"70%"})},toggle_handle_variable_prices:function(a){var t=e(this).closest("li").find('input.cs_custom_price_option[type="radio"]:checked').val(),i=e(this).closest("div.give-row-body").find(".cs_custom_prices_wrap");"enabled"===t?i.removeClass("give-hidden"):"disabled"===t&&i.addClass("give-hidden")},handle_show_hide:function(){var a=e('input[name="cs_status"]:radio'),t=e('input[name="cs_exchange_rates_update"]:radio'),i=e('input[name="cs_geolocation_state"]:radio'),n=e('select[name="cs_exchange_rates_providers"]'),c=e(".cs_general_fields"),s=e(".cs_exchange_rates_fields"),r=e(".cs_geo_location_fields");a.on("change",function(){var a=e('input[name="cs_status"]:radio:checked').val(),t=e(".give-settings-setting-page").find("ul.subsubsub").find("li:eq(1),li:eq(2) ");"enabled"===a?(c.show(),t.show(),e(".currency_switcher_geolocation_tab, .currency_switcher_gateway_tab").show()):(c.hide(),t.hide(),e(".currency_switcher_geolocation_tab, .currency_switcher_gateway_tab").hide())}).change(),t.on("change",function(a){if(!e('input[name="cs_exchange_rates_update"]').is(":visible")&&e(".post-body").is(":visible"))return!1;var t=e('input[name="cs_exchange_rates_update"]:checked').val();"enabled"===t?s.show():s.hide(),n.change()}).change(),i.on("change",function(){var a=e('input[name="cs_geolocation_state"]:checked').val();"enabled"===a?r.show():r.hide()}).change(),n.on("change",function(){var a=e('select[name="cs_exchange_rates_providers"]').val(),t=e('.cs_exchange_rates_update input[name="cs_exchange_rates_update"]:checked').val(),i=e(".cs_exchange_rates_update"),n=e(".cs_exchange_rates_interval");"0"===a?(i.hide(),n.hide()):i.show(),n.toggle("enabled"===t&&"0"!==a),"open-exchange-rates"===a?e(".cs_open_exchanges_app_id").show():e(".cs_open_exchanges_app_id").hide(),"fixer"===a?e(".cs_fixer_access_key").show():e(".cs_fixer_access_key").hide()}).change()},toggle_custom_amount:function(a){var t=e(this).attr("name"),i=e('input[name="_give_currency_price"]:checked').val(),n=e('input[name="_give_price_option"]:checked').val(),c=e(this).closest(".give_options_panel").find("._give_currency_price_field, #_give_cs_custom_prices_field"),s=e(this).closest(".give_options_panel").find("#_give_cs_custom_prices_field");"_give_price_option"===t&&("set"===n?(c.show(),"enabled"===i?s.show():s.hide()):c.hide()),"_give_currency_price"===t&&("enabled"===i&&"set"===n?s.show():s.hide())},update_exchange_rate:function(a){if(a.preventDefault(),e(this).hasClass("disabled"))return!1;var t=e(this).closest(".currency-switcher-table.cs_exchange_rates");t.addClass("currency-switcher-disabled-section");var i={};t.find("tr.exchange-rate-row").map(function(){i[e(this).data("currency")]={exchange_rate:e(this).find("input.exchange_rate").val(),set_manually:e(this).find("input.set_manually").is(":checked")?1:0,rate_markup:e(this).find("input.rate_markup").val()}}).get();var n={nonce:cs_admin_vars.update_exchange_nonce,action:"cs_update_exchange_rates",exchange_rate_inputs:JSON.stringify(i),setting_type:e(this).data("type"),form_id:e(this).data("formid")},c=e(this).closest(".give-cs-exchange-rate-table-bottom").find(".give-cs-loading-animation");c.removeClass("give-hidden"),e.ajax({type:"POST",url:cs_admin_vars.ajax_url,data:n,success:function(a){var i="";c.addClass("give-hidden"),!0===a.success&&a.data.rates?(e.each(a.data.rates,function(a,t){if(!1===t||0===t)return!0;var i=e('tr.exchange-rate-row[data-currency="'+a+'"]');i.find("input.set_manually").is(":checked")||i.find("input.exchange_rate").val(t)}),i=a.data.missed_currency.length>0?cs_admin_vars.messages.missed_rates_for+a.data.missed_currency.join(", "):cs_admin_vars.messages.exchange_rate_update):!1===a.success&&(i=a.error_message),""!==i&&(!0===a.success?new Give.modal.GiveSuccessAlert({modalContent:{title:give_vars.success,desc:i,cancelBtnTitle:give_vars.ok}}).render():new Give.modal.GiveErrorAlert({modalContent:{title:give_vars.error,desc:i,cancelBtnTitle:give_vars.ok}}).render()),t.removeClass("currency-switcher-disabled-section")}})},updateDefaultCurrencyList:function(a){var t=e(this).closest("label").text(),i=e(this).val(),n=e("#give_cs_default_currency");e(this).is(":checked")?n.append(e("<option></option>").attr("value",i).text(t)):e('#give_cs_default_currency option[value="'+i+'"]').remove()}};a.init()});